{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ahmetbozyel/Desktop/ajans-bee-platform/src/app/%28dashboard%29/ayarlar/actions.ts"],"sourcesContent":["'use server'\n\nimport { createClient } from '@supabase/supabase-js'\n\nconst supabaseAdmin = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.SUPABASE_SERVICE_ROLE_KEY!,\n  {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false\n    }\n  }\n)\n\nexport async function createUser(data: {\n  email: string\n  password: string\n  full_name: string\n  role: 'admin' | 'operasyon' | 'personel'\n}) {\n  try {\n    // 1. Auth'da kullanıcı oluştur (trigger otomatik public.users'a ekleyecek)\n    const { data: authData, error: authError } = await supabaseAdmin.auth.admin.createUser({\n      email: data.email,\n      password: data.password,\n      email_confirm: true,\n      user_metadata: {\n        full_name: data.full_name\n      }\n    })\n\n    if (authError) {\n      return { success: false, error: authError.message }\n    }\n\n    // 2. Trigger zaten ekledi, sadece role ve full_name güncelle\n    const { error: updateError } = await supabaseAdmin\n      .from('users')\n      .update({\n        full_name: data.full_name,\n        role: data.role\n      })\n      .eq('id', authData.user.id)\n\n    if (updateError) {\n      return { success: false, error: updateError.message }\n    }\n\n    return { success: true, user: authData.user }\n  } catch (err: any) {\n    return { success: false, error: err.message }\n  }\n}\n\nexport async function updateUser(\n  userId: string, \n  data: {\n    full_name?: string\n    role?: 'admin' | 'operasyon' | 'personel'\n    is_active?: boolean\n  }\n) {\n  try {\n    const { error } = await supabaseAdmin\n      .from('users')\n      .update({\n        ...data,\n        updated_at: new Date().toISOString()\n      })\n      .eq('id', userId)\n\n    if (error) {\n      return { success: false, error: error.message }\n    }\n\n    return { success: true }\n  } catch (err: any) {\n    return { success: false, error: err.message }\n  }\n}\n\nexport async function deleteUser(userId: string) {\n  try {\n    // 1. Public tablodan sil\n    const { error: deleteError } = await supabaseAdmin\n      .from('users')\n      .delete()\n      .eq('id', userId)\n\n    if (deleteError) {\n      return { success: false, error: deleteError.message }\n    }\n\n    // 2. Auth'dan sil\n    const { error: authError } = await supabaseAdmin.auth.admin.deleteUser(userId)\n\n    if (authError) {\n      return { success: false, error: authError.message }\n    }\n\n    return { success: true }\n  } catch (err: any) {\n    return { success: false, error: err.message }\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;AAEA;;;;AAEA,MAAM,gBAAgB,IAAA,qOAAY,gFAEhC,QAAQ,GAAG,CAAC,yBAAyB,EACrC;IACE,MAAM;QACJ,kBAAkB;QAClB,gBAAgB;IAClB;AACF;AAGK,eAAe,WAAW,IAKhC;IACC,IAAI;QACF,2EAA2E;QAC3E,MAAM,EAAE,MAAM,QAAQ,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,cAAc,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC;YACrF,OAAO,KAAK,KAAK;YACjB,UAAU,KAAK,QAAQ;YACvB,eAAe;YACf,eAAe;gBACb,WAAW,KAAK,SAAS;YAC3B;QACF;QAEA,IAAI,WAAW;YACb,OAAO;gBAAE,SAAS;gBAAO,OAAO,UAAU,OAAO;YAAC;QACpD;QAEA,6DAA6D;QAC7D,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,cAClC,IAAI,CAAC,SACL,MAAM,CAAC;YACN,WAAW,KAAK,SAAS;YACzB,MAAM,KAAK,IAAI;QACjB,GACC,EAAE,CAAC,MAAM,SAAS,IAAI,CAAC,EAAE;QAE5B,IAAI,aAAa;YACf,OAAO;gBAAE,SAAS;gBAAO,OAAO,YAAY,OAAO;YAAC;QACtD;QAEA,OAAO;YAAE,SAAS;YAAM,MAAM,SAAS,IAAI;QAAC;IAC9C,EAAE,OAAO,KAAU;QACjB,OAAO;YAAE,SAAS;YAAO,OAAO,IAAI,OAAO;QAAC;IAC9C;AACF;AAEO,eAAe,WACpB,MAAc,EACd,IAIC;IAED,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,cACrB,IAAI,CAAC,SACL,MAAM,CAAC;YACN,GAAG,IAAI;YACP,YAAY,IAAI,OAAO,WAAW;QACpC,GACC,EAAE,CAAC,MAAM;QAEZ,IAAI,OAAO;YACT,OAAO;gBAAE,SAAS;gBAAO,OAAO,MAAM,OAAO;YAAC;QAChD;QAEA,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,KAAU;QACjB,OAAO;YAAE,SAAS;YAAO,OAAO,IAAI,OAAO;QAAC;IAC9C;AACF;AAEO,eAAe,WAAW,MAAc;IAC7C,IAAI;QACF,yBAAyB;QACzB,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,cAClC,IAAI,CAAC,SACL,MAAM,GACN,EAAE,CAAC,MAAM;QAEZ,IAAI,aAAa;YACf,OAAO;gBAAE,SAAS;gBAAO,OAAO,YAAY,OAAO;YAAC;QACtD;QAEA,kBAAkB;QAClB,MAAM,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,cAAc,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC;QAEvE,IAAI,WAAW;YACb,OAAO;gBAAE,SAAS;gBAAO,OAAO,UAAU,OAAO;YAAC;QACpD;QAEA,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,KAAU;QACjB,OAAO;YAAE,SAAS;YAAO,OAAO,IAAI,OAAO;QAAC;IAC9C;AACF;;;IA1FsB;IAwCA;IA2BA;;AAnEA,sRAAA;AAwCA,sRAAA;AA2BA,sRAAA"}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":["file:///Users/ahmetbozyel/Desktop/ajans-bee-platform/.next-internal/server/app/%28dashboard%29/ayarlar/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {createUser as '4031db28220d4685ee7dbe6a55d32a4e18622b27fe'} from 'ACTIONS_MODULE0'\nexport {updateUser as '60f364d87ee7149ac8e95af200ae4f9b3bd1018f83'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}